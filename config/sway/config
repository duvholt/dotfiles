# This file has been auto-generated by i3-config-wizard(1).
# It will not be overwritten, so edit it as you like.
#
# Should you change your keyboard layout some time, delete
# this file and re-run i3-config-wizard(1).
#

# i3 config file (v4)
#
# Please see https://i3wm.org/docs/userguide.html for a complete reference!

include /etc/sway/config.d/*


exec systemctl --user set-environment XDG_SESSION_TYPE=wayland
exec systemctl --user set-environment XDG_CURRENT_DESKTOP=KDE
exec systemctl --user import-environment DISPLAY

# Qt (copied from random dotfiles)
exec systemctl --user set-environment QT_QPA_PLATFORM=wayland
exec systemctl --user set-environment QT_AUTO_SCREEN_SCALE_FACTOR=1
exec systemctl --user set-environment QT_WAYLAND_DISABLE_WINDOWDECORATION=1
exec systemctl --user set-environment QT_QPA_PLATFORMTHEME=kde
# KDE
exec systemctl --user set-environment XDG_MENU_PREFIX=plasma-

# From KDE zsh env
exec systemctl --user set-environment DESKTOP_SESSION=plasma
exec systemctl --user set-environment KDE_APPLICATIONS_AS_SCOPE=1
exec systemctl --user set-environment KDE_FULL_SESSION=true
exec systemctl --user set-environment KDE_SESSION_VERSION=6
# env = QT_AUTO_SCREEN_SCALE_FACTOR,0
exec systemctl --user set-environment QT_WAYLAND_RECONNECT=1
exec systemctl --user set-environment XDG_CURRENT_DESKTOP=KDE
# Testing
# env = XDG_CURRENT_DESKTOP,Hyprland,KDE
exec systemctl --user set-environment XDG_MENU_PREFIX=plasma-
exec systemctl --user set-environment XDG_SESSION_DESKTOP=KDE
exec systemctl --user set-environment KDE_SESSION_VERSION=6
exec systemctl --user set-environment KDE_APPLICATIONS_AS_SCOPE=1
exec systemctl --user set-environment KDE_FULL_SESSION=true
exec systemctl --user set-environment GTK_MODULES=canberra-gtk-module

exec systemctl --user set-environment ELECTRON_OZONE_PLATFORM_HINT=wayland

# GTK???
exec systemctl --user set-environment GDK_BACKEND=wayland

# Nvidia
# env = LIBVA_DRIVER_NAME,nvidia
# env = XDG_SESSION_TYPE,wayland
# env = GBM_BACKEND,nvidia-drm
# env = __GLX_VENDOR_LIBRARY_NAME,nvidia

exec systemctl --user set-environment XCURSOR_SIZE=36

exec_always --no-startup-id "systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_DESKTOP KDE_SESSION_VERSION XDG_MENU_PREFIX KDE_APPLICATIONS_AS_SCOPE KDE_FULL_SESSION"
# exec_always --no-startup-id "dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP"
exec_always --no-startup-id "systemctl --user import-environment XCURSOR_SIZE XCURSOR_THEME"

exec_always "shikanectl reload"

# Swayfx

blur enable
blur_passes 4
blur_radius 2
blur_noise 0
# blur_brightness 1
# blur_contrast 1
# blur_saturation 1

corner_radius 3
shadows enable
# default_dim_inactive 0.4



# Startup programs

set $mod Mod4

# Background
# exec_always --no-startup-id feh --bg-fill ~/.config/background
# output "*" bg ~/.config/background fill

# Solaar -  logitech devices
exec --no-startup-id "uwsm app -- solaar --window=hide"

# Plasma
exec --no-startup-id "systemctl --user start plasma-workspace-custom.target"
exec --no-startup-id "~/.local/bin/i3_kde_services.sh"

# Shikane (monitor switching)
exec --no-startup-id "uwsm app -- shikane"

# Waybar
exec --no-startup-id "systemctl --user start waybar"

#  Launcher
exec --no-startup-id "uwsm app -- walker --gapplication-service"
bindsym $mod+d exec walker
bindsym Mod1+space exec walker
# for_window [app_id="dev.benz.walker"] border none

# Lock on idle
set $lock "qdbus org.kde.ksmserver /ScreenSaver org.freedesktop.ScreenSaver.Lock"
exec swayidle -w \
	timeout 60 '$lock' \
	timeout 300 'swaymsg "output * power off"' \
		resume 'swaymsg "output * power on"'

input type:touchpad {
    natural_scroll true
    tap enabled
    tap_button_map lrm
    drag_lock disabled
}

input type:keyboard {
    xkb_layout eu,us
}

input type:pointer {
    accel_profile "flat"
}

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
#font pango:monospace 8

# This font is widely installed, provides lots of unicode glyphs, right-to-left
# text rendering and scalability on retina/hidpi displays (thanks to pango).
font pango:Noto Sans 10

# The combination of xss-lock, nm-applet and pactl is a popular choice, so
# they are included here as an example. Modify as you see fit.

# xss-lock grabs a logind suspend inhibit lock and will use i3lock to lock the
# screen before suspend. Use loginctl lock-session to lock your screen.
# exec --no-startup-id xss-lock --transfer-sleep-lock -- i3lock --nofork

# NetworkManager is the most popular way to manage wireless networks on Linux,
# and nm-applet is a desktop environment-independent system tray GUI for it.
# exec --no-startup-id nm-applet

# Use pactl to adjust volume in PulseAudio.
# set $refresh_i3status killall -SIGUSR1 i3status
# bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +10% && $refresh_i3status
# bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -10% && $refresh_i3status
# bindsym XF86AudioMute exec --no-startup-id pactl set-sink-mute @DEFAULT_SINK@ toggle && $refresh_i3status
# bindsym XF86AudioMicMute exec --no-startup-id pactl set-source-mute @DEFAULT_SOURCE@ toggle && $refresh_i3status

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# start a terminal
bindsym $mod+Return exec --no-startup-id systemd-run --user -E WINIT_X11_SCALE_FACTOR=1 alacritty
bindsym $mod+Shift+Return exec --no-startup-id WINIT_X11_SCALE_FACTOR=1 alacritty

# kill focused window
bindsym $mod+Shift+q kill

# change focus
bindsym $mod+j focus left
bindsym $mod+k focus down
# bindsym $mod+l focus up
bindsym $mod+semicolon focus right

# alternatively, you can use the cursor keys:
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# move focused window
bindsym $mod+Shift+j move left
bindsym $mod+Shift+k move down
bindsym $mod+Shift+l move up
bindsym $mod+Shift+colon move right

# alternatively, you can use the cursor keys:
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# split in horizontal orientation
bindsym $mod+h split h

# split in vertical orientation
bindsym $mod+v split v

# toggle maximized mode for the focused container
# bindsym $mod+shift+f exec ~/.local/bin/i3_maximize.sh
# enter fullscreen mode for the focused container
bindsym $mod+f floating toggle, resize set width 100ppt height 98ppt
bindsym $mod+shift+f fullscreen

# change container layout (stacked, tabbed, toggle split)
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# toggle sticky floating window
bindsym $mod+Mod1+space sticky toggle

# change focus between tiling / floating windows
bindsym $mod+space focus mode_toggle

# toggle window title
bindsym $mod+t border normal 3

# focus the parent container
bindsym $mod+a focus parent

# Lock
bindsym $mod+l exec $lock


bindsym XF86AudioRaiseVolume exec wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
bindsym XF86AudioLowerVolume exec wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindsym XF86AudioMute exec wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindsym XF86AudioMicMute exec wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
# Generic way
# bindsym XF86MonBrightnessDown exec brightnessctl set 5%-
# bindsym XF86MonBrightnessUp exec brightnessctl set 5%+
# KDE specfic for OSD support
bindsym XF86MonBrightnessDown exec qdbus org.kde.Solid.PowerManagement /org/kde/Solid/PowerManagement/Actions/BrightnessControl org.kde.Solid.PowerManagement.Actions.BrightnessControl.setBrightness $(expr $(qdbus org.kde.Solid.PowerManagement /org/kde/Solid/PowerManagement/Actions/BrightnessControl org.kde.Solid.PowerManagement.Actions.BrightnessControl.brightness) - 75)
bindsym XF86MonBrightnessUp exec qdbus org.kde.Solid.PowerManagement /org/kde/Solid/PowerManagement/Actions/BrightnessControl org.kde.Solid.PowerManagement.Actions.BrightnessControl.setBrightness $(expr $(qdbus org.kde.Solid.PowerManagement /org/kde/Solid/PowerManagement/Actions/BrightnessControl org.kde.Solid.PowerManagement.Actions.BrightnessControl.brightness) + 75)
bindsym XF86AudioPlay exec playerctl play-pause
bindsym XF86AudioPause exec playerctl play-pause
bindsym XF86AudioNext exec playerctl next
bindsym XF86AudioPrev exec playerctl previous
bindsym XF86AudioStop exec playerctl stop

bindsym Mod1+Shift+Up exec playerctl play-pause


bindsym Print exec screengrab

# focus the child container
# bindsym $mod+d focus child

# Define names for default workspaces for which we configure key bindings later on.
# We use variables to avoid repeating the names in multiple places.
set $ws1 "1 General"
set $ws2 "2 Chat"
set $ws3 "3 Code 1"
set $ws4 "4 Code 2"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10 Music"

# Monitors
set $laptop "eDP-1"
set $home "HDMI-2"
set $work1 "DP-2-3-8"
set $work2 "DP-2-2-8"

# Assign workspaces to monitors
workspace $ws1 output $home $work1
workspace $ws2 output $work2 $laptop
workspace $ws3 output $home $work1
workspace $ws4 output $work2 $home
workspace $ws5 output $work1 $laptop


# switch to workspace
bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
bindsym $mod+6 workspace number $ws6
bindsym $mod+7 workspace number $ws7
bindsym $mod+8 workspace number $ws8
bindsym $mod+9 workspace number $ws9
bindsym $mod+0 workspace number $ws10

# workspace_auto_back_and_forth yes

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number $ws1; workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2; workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3; workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4; workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5; workspace number $ws5
bindsym $mod+Shift+6 move container to workspace number $ws6; workspace number $ws6
bindsym $mod+Shift+7 move container to workspace number $ws7; workspace number $ws7
bindsym $mod+Shift+8 move container to workspace number $ws8; workspace number $ws8
bindsym $mod+Shift+9 move container to workspace number $ws9; workspace number $ws9
bindsym $mod+Shift+0 move container to workspace number $ws10; workspace number $ws10

# reload the configuration file
bindsym $mod+Shift+c reload
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart
# exit i3 (logs you out of your X session)
bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -B 'Yes, exit i3' 'i3-msg exit'"

# resize window (you can also use the mouse for that)
mode "resize" {
        # These bindings trigger as soon as you enter the resize mode

        # Pressing left will shrink the window’s width.
        # Pressing right will grow the window’s width.
        # Pressing up will shrink the window’s height.
        # Pressing down will grow the window’s height.
        bindsym j resize shrink width 10 px or 10 ppt
        bindsym k resize grow height 10 px or 10 ppt
        bindsym l resize shrink height 10 px or 10 ppt
        bindsym semicolon resize grow width 10 px or 10 ppt

        # same bindings, but for the arrow keys
        bindsym Left resize shrink width 10 px or 10 ppt
        bindsym Down resize grow height 10 px or 10 ppt
        bindsym Up resize shrink height 10 px or 10 ppt
        bindsym Right resize grow width 10 px or 10 ppt

        # back to normal: Enter or Escape or $mod+r
        bindsym Return mode "default"
        bindsym Escape mode "default"
        bindsym $mod+r mode "default"
}

bindsym $mod+r mode "resize"

# Gaps
smart_gaps on
# smart_borders on
gaps outer 0
gaps inner 8

# Borders
default_border pixel 3
# Try to fix csd apps
for_window [tiling] border pixel 3

# Colors
set $background "#252e38"
set $foreground "#dfdfdf"
set $black "#282c34"
set $white "#abb2bf"
set $light_red "#e06c75"
set $dark_red "#be5046"
set $green "#98c379"
set $light_yellow "#e5c07b"
set $dark_yellow "#d19a66"
set $blue "#61afef"
set $magenta "#c678dd"
set $cyan "#56b6c2"
set $gutter_grey "#4b5263"
set $comment_grey "#5c6370"

# class                 border          bground         text        indicator       child_border
client.focused          $blue           $blue           $black      $light_yellow   $blue
client.focused_inactive $comment_grey   $comment_grey   $foreground $dark_yellow    $background
client.unfocused        $background     $background     $foreground $dark_yellow    $background
client.urgent           $dark_red       $dark_red       $foreground $dark_red       $dark_red

# Auto focus urgent
# focus_on_window_activation urgent
focus_on_window_activation focus

# Disable mouse warping
mouse_warping none

# Disable autofocus on mouse move
focus_follows_mouse no


for_window [app_id="dev.benz.walker"] floating enable; border none

### KDE config ###
# Send Plasma desktop background to scratchpad
# Desktop window is used to position notifications, so killing it can sometimes cause notifications
# to display offscreen or in other unintended places. 
# for_window [title="Desktop @ QRect"] floating enable, move scratchpad
# Show Plasma desktop window
# bindsym $mod+Mod1+minus [title="Desktop @ QRect"] scratchpad show

# Remove focus from Plasma and Latte
#no_focus [class="plasmashell|lattedock" window_type="notification"]
# Float and remove borders from plasma and latte windows
#for_window [class="plasmashell|lattedock|kscreen_osd_service|Plasma"] floating enable, border none
#for_window [app_id="org.kde.plasmashell"] floating enable, border none

for_window [class="plasma-welcome"] floating enable

# Restart plasmashell
bindsym $mod+Mod1+r exec "systemctl --user restart plasma-plasmashell.service"
# Run autorandr
# bindsym $mod+Mod1+a exec "autorandr -c"

# JetBrains toolbox
for_window [class="jetbrains-toolbox"] floating enable, border none

# IntelliJ
for_window [class="jetbrains-idea"] border pixel 3
for_window [class="jetbrains-idea" title="win0"] floating enable
for_window [class="^jetbrains-.+"][window_type=dialog] focus

# Android Emulator
for_window [title="^Android Emulator"] floating enable, border none


# move workspace between monitors
bindsym Ctrl+$mod+Up move workspace to output up
bindsym Ctrl+$mod+Right move workspace to output right
bindsym Ctrl+$mod+Down move workspace to output down
bindsym Ctrl+$mod+Left move workspace to output left

# Next/prev workspace
bindsym Ctrl+Mod1+Right workspace next
bindsym Ctrl+Mod1+Left workspace prev
bindsym Ctrl+Shift+Mod1+Right move container to workspace next; workspace next
bindsym Ctrl+Shift+Mod1+Left move container to workspace prev; workspace prev

# Make the currently focused window a scratchpad
bindsym $mod+Shift+minus move scratchpad

# Show the first scratchpad window except for Plasma Desktop
# bindsym $mod+minus [title="^(?!Desktop — Plasma).*$"] scratchpad show


popup_during_fullscreen leave_fullscreen


# Copied from the internet
# Plasma compatibility improvements
for_window [window_role="pop-up"] floating enable
for_window [window_role="task_dialog"] floating enable

for_window [app_id="kdesystemsettings"] floating enable
no_focus [app_id="org.kde.plasmashell"]
for_window [app_id="org.kde.plasmashell"] floating enable, border none, move position 80 ppt 2 ppt
for_window [app_id="org.kde.plasmashell"] blur disable, shadows disable
# for_window [app_id="org.kde.plasmashell"] move 10% 10%;
for_window [class="Plasmoidviewer"] floating enable, border none
# for_window [app_id="org.kde.plasmashell" title="Plasma"] border none, move right 40ppt, move down 40ppt
# for_window [app_id="org.kde.plasmashell"] exec ~/.local/bin/i3-move-to top-right
for_window [app_id="org.kde.plasma.emojier"] floating enable; border none
for_window [app_id="org.kde.plasmawindowed"] floating enable, border none, move position 80 ppt 2 ppt
